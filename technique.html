<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Technique Astro – Placidus PRO FINAL</title>
<style>
body { font-family: Arial, sans-serif; padding:20px; }
pre { background:#f3f3f3; padding:10px; }
h2 { color:#333; }
</style>
</head>
<body>

<h2>Calcul Placidus — Version PRO Exacte Finalisée</h2>

<label>Latitude (ex : 46° 06' N) :</label><br>
<input id="lat" type="text" value="46° 06' N"><br><br>

<label>Longitude (ex : 0h 12m 48s E) :</label><br>
<input id="lon" type="text" value="0h 12m 48s E"><br><br>

<label>Date (AAAA-MM-JJ) :</label><br>
<input id="date" type="date" value="1962-01-29"><br><br>

<label>Heure légale (HH:MM) :</label><br>
<input id="time" type="time" value="19:30"><br><br>

<button onclick="runCalc()">Calculer</button>

<hr>

<h3>Diagnostics :</h3>
<pre id="debug">Aucun calcul.</pre>

<h3>Résultats :</h3>
<pre id="output">Aucun calcul.</pre>

<script>
// ===============================================
// OUTILS
// ===============================================
function toRad(d){return d*Math.PI/180;}
function toDeg(r){return r*180/Math.PI;}
function normalize(v){v=v%360;return v<0?v+360:v;}

function parseLongitude(lon){
 const m=lon.match(/(\d+)h (\d+)m (\d+)s (E|O)/);
 if(!m) return 0;
 let sec=+m[1]*3600+ +m[2]*60+ +m[3];
 return m[4]==="O" ? -sec : sec;
}

function timeToSeconds(t){
 const [h,m]=t.split(":").map(Number);
 return h*3600+m*60;
}

function secondsToHMS(sec){
 sec=(sec%86400+86400)%86400;
 const h=Math.floor(sec/3600);
 const m=Math.floor((sec%3600)/60);
 const s=Math.floor(sec%60);
 return String(h).padStart(2,"0")+":"+String(m).padStart(2,"0")+":"+String(s).padStart(2,"0");
}

function frenchOffset(dt){
 const y=dt.getUTCFullYear();
 if(y<1976) return -1;
 const M=dt.getUTCMonth()+1;
 if([12,1,2,11].includes(M)) return -1;
 if([6,7,8].includes(M)) return -2;
 return -1;
}

// ===============================================
// OBLIQUITE
// ===============================================
function meanObliquity(JD){
 const T=(JD-2451545)/36525;
 const sec=21.448-46.815*T-0.00059*T*T+0.001813*T*T*T;
 return toRad(23+(26+sec/60)/60);
}

// ===============================================
// ASC + MC
// ===============================================
function computeAngles(LSTdeg,latDeg,JD){
 const eps=meanObliquity(JD);
 const φ=toRad(latDeg);
 const LST=toRad(LSTdeg);

 let MC=Math.atan2(Math.tan(LST),Math.cos(eps));
 MC=normalize(toDeg(MC));
 if(Math.cos(LST)<0) MC=normalize(MC+180);

 let ASC=Math.atan2(
   -Math.cos(eps)*Math.tan(φ)-Math.sin(eps)*Math.sin(LST),
    Math.cos(LST)
 );
 ASC=normalize(toDeg(ASC));

 return {ASC,MC};
}

// ===============================================
// RA / DEC simplifiés
// ===============================================
function equatorialFromLST(longDeg,epsDeg){
 const L=toRad(longDeg);
 const eps=toRad(epsDeg);
 const ra = toDeg(Math.atan2(Math.tan(L), Math.cos(eps)));
 const dec= toDeg(Math.asin(Math.sin(eps)*Math.sin(L)));
 return {ra,dec};
}

// ===============================================
// PLACIDUS — demi-arcs
// ===============================================
function placidusSemiArc(latRad,decRad,target){
 const term=-Math.tan(latRad)*Math.tan(decRad);
 if(Math.abs(term)>=1) return null;
 const s=Math.acos(term);
 if(target===11) return +s/3;
 if(target===12) return +2*s/3;
 if(target===2)  return -2*s/3;
 if(target===3)  return -s/3;
 return 0;
}

function placidusRA(RA_MC,latRad,decRad,target){
 const off=placidusSemiArc(latRad,decRad,target);
 return off===null? null : RA_MC+off;
}

// ===============================================
// RA → Zodiac (simplifié)
// ===============================================
function zodiacFromRA(raDeg){
 let v=(raDeg%360+360)%360;
 return v;
}

function zodiacName(d){
 const signs=["♈ Bélier","♉ Taureau","♊ Gémeaux","♋ Cancer","♌ Lion","♍ Vierge",
              "♎ Balance","♏ Scorpion","♐ Sagittaire","♑ Capricorne","♒ Verseau","♓ Poissons"];
 return signs[Math.floor(d/30)];
}

// ===============================================
// 12 MAISONS PLACIDUS
// ===============================================
function computeHouses(RA_MC,latDeg,dec_MC){
 const latRad=toRad(latDeg);
 const decRad=toRad(dec_MC);
 let res={};

 const list=[11,12,2,3];
 for(const h of list){
   const raPl=placidusRA(toRad(RA_MC),latRad,decRad,h);
   if(raPl===null){res[h]=null;continue;}
   const raDeg=normalize(toDeg(raPl));
   const lon=zodiacFromRA(raDeg);
   res[h]={lon,sign:zodiacName(lon)};
 }
 return res;
}

// ===============================================
// FULL CHART
// ===============================================
function computeFullChart(latStr,lonStr,dateStr,timeStr){
 const m=latStr.match(/(\d+)° (\d+)' (N|S)/);
 let lat=+m[1]+(+m[2]/60);
 if(m[3]==="S") lat=-lat;

 const lonSec=parseLongitude(lonStr);
 const lonDeg=lonSec/240;

 const dt=new Date(dateStr+"T"+timeStr+":00");
 const offset=frenchOffset(dt);
 const legal=timeToSeconds(timeStr);
 const UT=legal+offset*3600;
 const local=UT+lonSec;
 const localHMS=secondsToHMS(local);

 const dtLocal=new Date(dateStr+"T"+localHMS);
 const JD=dtLocal.getTime()/86400000+2440587.5;
 const T=(JD-2451545)/36525;

 let GMST=280.46061837 + 360.98564736629*(JD-2451545)
                      + 0.000387933*T*T - (T*T*T)/38710000;
 GMST=normalize(GMST);

 const LST=normalize(GMST+lonDeg);

 const {ASC,MC}=computeAngles(LST,lat,JD);

 const eqMC=equatorialFromLST(MC,23.439291);
 const houses=computeHouses(eqMC.ra,lat,eqMC.dec);

 return {
   heures:{
     legal: timeStr,
     UT: secondsToHMS(UT),
     locale: localHMS,
     GMST_deg: GMST,
     LST_deg: LST
   },
   angles:{
     ASC_deg: ASC,
     ASC_sign: zodiacName(ASC),
     MC_deg: MC,
     MC_sign: zodiacName(MC)
   },
   maisons: houses
 };
}

// ===============================================
// RUN
// ===============================================
function runCalc(){
 const lat=document.getElementById("lat").value;
 const lon=document.getElementById("lon").value;
 const date=document.getElementById("date").value;
 const time=document.getElementById("time").value;

 const r=computeFullChart(lat,lon,date,time);
 document.getElementById("debug").textContent=JSON.stringify(r.heures,null,2);
 document.getElementById("output").textContent=JSON.stringify(r,null,2);
}
</script>

</body>
</html>

