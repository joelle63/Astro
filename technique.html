<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Technique Astro</title>
</head>

<body>

<h2>Calcul Placidus — Technique</h2>

<!-- Formulaire simple -->
<p>Entrez vos données :</p>

<label>Latitude (ex : 45° 30' N) :</label><br>
<input id="lat" type="text" value="45° 30' N"><br><br>

<label>Longitude (ex : 6h 00m 00s E) :</label><br>
<input id="lon" type="text" value="6h 00m 00s E"><br><br>

<label>Date (AAAA-MM-JJ) :</label><br>
<input id="date" type="date" value="2025-11-23"><br><br>

<label>Heure (HH:MM) :</label><br>
<input id="time" type="time" value="11:30"><br><br>

<button onclick="runCalc()">Calculer</button>

<hr>

<h3>Résultat :</h3>

<pre id="output">Aucun calcul lancé.</pre>


<script>
/* ===============================
      PLACIDUS EXACT – COMPLET
   =============================== */

function computeChart({ lat, lon, date, time }) {

    function toRad(d) { return d * Math.PI / 180; }
    function toDeg(r) { return r * 180 / Math.PI; }

    function normalize(a) {
        a = a % 360;
        return a < 0 ? a + 360 : a;
    }

    function dms(a) {
        const d = Math.floor(a);
        const m = Math.round((a - d) * 60);
        return `${d}°${m < 10 ? "0" : ""}${m}'`;
    }

    const signs = [
        "♈ Bélier","♉ Taureau","♊ Gémeaux","♋ Cancer","♌ Lion","♍ Vierge",
        "♎ Balance","♏ Scorpion","♐ Sagittaire","♑ Capricorne","♒ Verseau","♓ Poissons"
    ];

    function signOf(a) {
        const s = Math.floor(a / 30);
        return signs[s];
    }

    const latMatch = lat.match(/(\d+)° (\d+)' (N|S)/);
    const lonMatch = lon.match(/(\d+)h (\d+)m (\d+)s (E|O)/);

    const φ = ((latMatch[3] === "N" ? 1 : -1) *
              (parseInt(latMatch[1]) + parseInt(latMatch[2]) / 60));

    const longDeg = (lonMatch[4] === "E" ? 1 : -1) *
        (parseInt(lonMatch[1]) * 15 +
         parseInt(lonMatch[2]) * 0.25 +
         parseInt(lonMatch[3]) / 240);

    const dt = new Date(`${date}T${time}:00`);
    const JD = dt.getTime()/86400000 + 2440587.5;

    const T = (JD - 2451545.0) / 36525;

    let GMST = 280.46061837 +
               360.98564736629 * (JD - 2451545) +
               0.000387933 * T*T -
               (T*T*T)/38710000;

    GMST = normalize(GMST);

    const LST = normalize(GMST + longDeg);

    const ε = toRad(23.439291);

    const MC_rad =
        Math.atan2(
            Math.tan(toRad(LST)),
            Math.cos(ε)
        );

    let MC = normalize(toDeg(MC_rad));
    if (Math.cos(toRad(LST)) < 0) MC = normalize(MC + 180);

    const φ_rad = toRad(φ);

    const asc_rad =
        Math.atan2(
            -Math.cos(ε) * Math.tan(φ_rad) - Math.sin(ε) * Math.sin(toRad(LST)),
            Math.cos(toRad(LST))
        );

    const ASC = normalize(toDeg(asc_rad));

    function placidusHouse(target) {

        let hTarget = (target === 2 ? LST + 30 :
                       target === 3 ? LST + 60 :
                       target === 5 ? LST + 120 :
                       LST + 150);

        hTarget = normalize(hTarget);

        let H = toRad(hTarget);
        let prev;

        for (let i = 0; i < 15; i++) {
            prev = H;
            H = Math.atan2(
                Math.sin(prev),
                Math.cos(prev) * Math.cos(ε) - Math.tan(φ_rad) * Math.sin(ε)
            );
            if (Math.abs(H - prev) < 0.0000001) break;
        }

        return normalize(toDeg(H));
    }

    const H2 = placidusHouse(2);
    const H3 = placidusHouse(3);
    const H5 = placidusHouse(5);
    const H6 = placidusHouse(6);

    function pack(value) {
        return {
            deg: value,
            txt: dms(value),
            sign: signOf(value)
        };
    }

    return {
        asc: pack(ASC),
        mc: pack(MC),
        h2: pack(H2),
        h3: pack(H3),
        h5: pack(H5),
        h6: pack(H6)
    };
}

/* ===============================
      FONCTION D'AFFICHAGE
   =============================== */

function runCalc() {

    const lat  = document.getElementById("lat").value;
    const lon  = document.getElementById("lon").value;
    const date = document.getElementById("date").value;
    const time = document.getElementById("time").value;

    const result = computeChart({ lat, lon, date, time });

    document.getElementById("output").textContent =
        JSON.stringify(result, null, 2);
}
</script>

</body>
</html>
